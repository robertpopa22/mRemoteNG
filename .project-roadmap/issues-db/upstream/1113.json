{
  "number": 1113,
  "repo": "mRemoteNG/mRemoteNG",
  "title": "Settings RDP loadbalanceinfo causes An internal error has occured",
  "state": "open",
  "labels": [
    "RDP",
    "Security",
    "Improvement required",
    "Windows"
  ],
  "author": "xlash",
  "created_at": "2018-09-28T15:56:33Z",
  "github_updated_at": "2024-05-10T12:13:05Z",
  "body_snippet": "## Issue\r\nAs soon as I set anything in the loadbalanceinfo of a RDP session, I get a Message: 4 An internal error has occured.\r\n\r\n## Expected Behavior\r\nTo connect to my RDS server farm and provide the loadbalanceinfo\r\n\r\n## Your Environment\r\n* Windows 10 Pro 1803 x64 17134.319\r\nmRemoteNG version 1.75.7012.16814\r\n",
  "our_status": "triaged",
  "priority": "P2-bug",
  "target_release": null,
  "our_branch": null,
  "our_pr": null,
  "iterations": [
    {
      "seq": 1,
      "date": "2026-02-19",
      "type": "triaged",
      "description": "LoadBalanceInfo defaults to UTF-16 encoding but RDP protocol requires UTF-8; the encoder exists but default is False, causing connection failures for all RDS farm users"
    }
  ],
  "comments": [
    {
      "id": "MDEyOklzc3VlQ29tbWVudDQyNTczMjA5Ng==",
      "author": "sparerd",
      "date": "2018-09-30T16:15:30Z",
      "snippet": "Do you get the error message when trying to connect to the server or when setting the loadbalanceinfo property in mRemoteNG?\r\n\r\nIs your server hosted in Azure, by any chance? If so, this might be related to #829 or #523.",
      "is_ours": false,
      "analyzed": false,
      "action_needed": true
    },
    {
      "id": "MDEyOklzc3VlQ29tbWVudDQyNTc0NDQyNg==",
      "author": "xlash",
      "date": "2018-09-30T19:18:52Z",
      "snippet": "Error is when connecting.\r\n\r\nServer is on our LAN.\r\n\r\n#829 is the pull request to include this functionnality. It could be an error handling this, I don't know.\r\n\r\n#523 There isn't enough details about the error. It might be related. I did a network capture, and I saw a TLS1.2 packet before encryption which contains loadbalancinginfo with the RDS pool name. Not the cookie hash mentionned.",
      "is_ours": false,
      "analyzed": false,
      "action_needed": true
    },
    {
      "id": "MDEyOklzc3VlQ29tbWVudDQyNTc1MDIyMw==",
      "author": "sparerd",
      "date": "2018-09-30T20:38:59Z",
      "snippet": "Does the value in your loadbalanceinfo section follow the rules mentioned in the \"remarks\" section here? https://docs.microsoft.com/en-us/windows/desktop/TermServ/imsrdpclientadvancedsettings-loadbalanceinfo#remarks",
      "is_ours": false,
      "analyzed": false,
      "action_needed": true
    },
    {
      "id": "MDEyOklzc3VlQ29tbWVudDQyNTkxMDU1Mg==",
      "author": "xlash",
      "date": "2018-10-01T13:37:43Z",
      "snippet": "No, it does not use the Cookie syntax. The configured value is : \r\ntsv://MS Terminal Services Plugin.1.RDS-XXXXX\\r\\n\r\n\r\nWith native Windows Remote Desktop, I see this field provided in the first TLS packet sent (after TCP/IP handshake). \r\n0000   00 1c 7f 85 6e 1a 9c b6 d0 ff e0 bb 08 00 45 00   ....n..¶Ðÿà»..E.\r\n0010   00 6b 3c 42 40 00 80 06 2e e5 c0 a8 8c 0a c0 a8   .k<B@....åÀ¨..À¨\r\n0020   82 0a d4 95 0d 3d ce 34 4e 86 75 bd 13 f4 50 18   ..Ô..=Î4N.u½.ôP.\r\n0030   01 00 cb d4 00 00 03 00 00 43...",
      "is_ours": false,
      "analyzed": false,
      "action_needed": true
    },
    {
      "id": "MDEyOklzc3VlQ29tbWVudDQyNjYxODU0Ng==",
      "author": "sparerd",
      "date": "2018-10-03T12:26:23Z",
      "snippet": "Hmm that is interesting. The original reason for #829 was that .NET uses UTF-16 encoded strings by default, but Azure was expecting UTF-8 encoded. It seems like that may be what is happening here as well.\r\n\r\nWould you be able to try the most recent v1.76 version (you can grab the portable version if you don't want to upgrade fully yet)? Turn on the following setting and see if the connection works: `Tools -> Options -> Advanced -> Use UTF8 encoding for RDP 'Load Balance Info' property`",
      "is_ours": false,
      "analyzed": false,
      "action_needed": true
    },
    {
      "id": "MDEyOklzc3VlQ29tbWVudDQyNjYzNjU2MQ==",
      "author": "xlash",
      "date": "2018-10-03T13:26:21Z",
      "snippet": "Works with 1.76.3 Alpha 5 (2018-03-14). I had another issue. Seems like, after the TLS connection is established, the RD server redirects to another server, which works seemlessly with RDP, but don't with mRemoteNG. However, going directly to that host works for me.\r\n\r\nThanks,\r\n\r\n![image](https://user-images.githubusercontent.com/50488/46413141-52e42680-c6ee-11e8-8343-b0a279d3b385.png)\r\n",
      "is_ours": false,
      "analyzed": false,
      "action_needed": true
    },
    {
      "id": "MDEyOklzc3VlQ29tbWVudDQyNjk1OTI0Mg==",
      "author": "Shooshka",
      "date": "2018-10-04T10:01:39Z",
      "snippet": "Maybe same here.. trying to connect to our RDS farm with \"loadbalanceinfo\" many times with different options/mremoteng versions, but was too lazy to create issue :(\r\n\r\nNow it's 1.76.8, \"tsv://MS Terminal Services Plugin.1.1cdev\" or \"tsv://MS Terminal Services Plugin.1.1cdev\\r\\n\" in loadbalaceinfo.\r\n\r\nWithout \"UTF8\" checked it's error that says cannot connect ot gateway, with \"UTF8\" checked it's just closes connection in 1-5 sec after \"Connecting\" without any errors.\r\n\r\nAnd if I use .rdp file wit...",
      "is_ours": false,
      "analyzed": false,
      "action_needed": true
    },
    {
      "id": "MDEyOklzc3VlQ29tbWVudDQyNzAxMDU1OQ==",
      "author": "sparerd",
      "date": "2018-10-04T13:04:46Z",
      "snippet": "@xlash You can try setting the `Use Console Session` property for that connection to `True` (or right click the session -> Connect with options -> Connect to console session). Beyond that I'm not entirely sure what could be causing that error.\r\n\r\n@Shooshka does the mRemoteNG.log file show why the session was disconnected? https://github.com/mRemoteNG/mRemoteNG/wiki/Troubleshooting-and-Logging",
      "is_ours": false,
      "analyzed": false,
      "action_needed": true
    },
    {
      "id": "MDEyOklzc3VlQ29tbWVudDQyNzE1OTk3Nw==",
      "author": "xlash",
      "date": "2018-10-04T20:35:03Z",
      "snippet": "@sparerd Thanks!",
      "is_ours": false,
      "analyzed": false,
      "action_needed": true
    },
    {
      "id": "MDEyOklzc3VlQ29tbWVudDQyNzE2MjY2Nw==",
      "author": "sparerd",
      "date": "2018-10-04T20:44:07Z",
      "snippet": "@xlash Is it working for you now?",
      "is_ours": false,
      "analyzed": false,
      "action_needed": true
    },
    {
      "id": "MDEyOklzc3VlQ29tbWVudDQyNzI0NDcyNg==",
      "author": "Shooshka",
      "date": "2018-10-05T04:44:22Z",
      "snippet": "> @Shooshka does the mRemoteNG.log file show why the session was disconnected? https://github.com/mRemoteNG/mRemoteNG/wiki/Troubleshooting-and-Logging\r\n\r\n@sparerd \r\n\r\nUTF8 checked, tsv://MS Terminal Services Plugin.1.1cdev\\r\\n in loadbalanceinfo:\r\n\r\nSmth like: \"Your computer cannot connect to the remote desktop, because broker/gw can't verify parameters of RDP file.\"\r\n\r\nSo I think problem in \"signature:s:\" section that persists in .rdp file but missing in mRemoteNG.",
      "is_ours": false,
      "analyzed": false,
      "action_needed": true
    },
    {
      "id": "MDEyOklzc3VlQ29tbWVudDQyODU2MjY0MA==",
      "author": "xlash",
      "date": "2018-10-10T13:02:48Z",
      "snippet": "No, got session denied (visually by RDS host). Investigating the delta.",
      "is_ours": false,
      "analyzed": false,
      "action_needed": true
    },
    {
      "id": "MDEyOklzc3VlQ29tbWVudDQyODU2ODM1MQ==",
      "author": "xlash",
      "date": "2018-10-10T13:20:11Z",
      "snippet": "I see the TLS negotiation successfull, I'm able to authenticate using Windows  (NTLM?), but then, it silently closes without notification. In the network capture, I see a TCP reset send by mRemoteNG to the host.",
      "is_ours": false,
      "analyzed": false,
      "action_needed": true
    },
    {
      "id": "MDEyOklzc3VlQ29tbWVudDQ0NTExNjA1MQ==",
      "author": "Shooshka",
      "date": "2018-12-07T04:04:23Z",
      "snippet": "@sparerd Any updates/news on connections with \"signature\"?",
      "is_ours": false,
      "analyzed": false,
      "action_needed": true
    },
    {
      "id": "MDEyOklzc3VlQ29tbWVudDQ3MDg1MDQ1MQ==",
      "author": "tiboudchik",
      "date": "2019-03-08T08:41:37Z",
      "snippet": "Hello.\r\nCould you confirm if mRemoteNG will be able to manage \"signature\" in next releases ?\r\nThanks.",
      "is_ours": false,
      "analyzed": false,
      "action_needed": true
    },
    {
      "id": "MDEyOklzc3VlQ29tbWVudDUyOTMyNTAzNw==",
      "author": "7OH",
      "date": "2019-09-09T06:53:46Z",
      "snippet": "Got only once connect by mRemoteNG with loadbalanceinfo in version 1.77.\r\nBut it was only once.\r\nCannot reproduce this now and it's sad.",
      "is_ours": false,
      "analyzed": false,
      "action_needed": true
    },
    {
      "id": "IC_kwDOAAcIMM5I7pwS",
      "author": "AdamPD",
      "date": "2022-08-23T06:14:27Z",
      "snippet": "Same issue here I'm afraid.  Exactly as the others said.  Tried latest nightly build and it errors whether or not the UTF8 option is ticked.",
      "is_ours": false,
      "analyzed": false,
      "action_needed": true
    },
    {
      "id": "IC_kwDOAAcIMM59cCm7",
      "author": "Xyllac",
      "date": "2024-05-10T12:13:04Z",
      "snippet": "Hi, \r\nI have the same issue in the lastest nightly build (1.77.3 build: 1784) \r\nHere's what the log says :\r\n\"Your computer cannot connect to the remote computer because the Broker service can't verify the specified settings in the RDP file.\"\r\nIs there any news about it ?",
      "is_ours": false,
      "analyzed": false,
      "action_needed": true
    }
  ],
  "comments_cursor": "2024-05-10T12:13:05Z",
  "unread_comments": 18,
  "needs_action": true,
  "waiting_for_us": true,
  "last_synced": "2026-02-15T09:52:50Z",
  "notes": "AI triage (claude): LoadBalanceInfo defaults to UTF-16 encoding but RDP protocol requires UTF-8; the encoder exists but default is False, causing connection failures for all RDS farm users\nApproach: Change default value of RdpLoadBalanceInfoUseUtf8 from False to True so LoadBalanceInfo is always UTF-8 encoded, which is what the RDP protocol requires"
}
