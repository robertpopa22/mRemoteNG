{
  "task_type": "implement",
  "task_id": "1171",
  "started_at": "2026-02-17T04:59:31",
  "finished_at": "2026-02-17T05:14:13",
  "attempts": [
    {
      "agent": "codex",
      "task": "implement #1171",
      "success": false,
      "result": null,
      "raw_output": "",
      "errors": "Agent returned None after retries",
      "files_modified": [],
      "build_result": null,
      "test_result": null,
      "timed_out": false,
      "diff_summary": null,
      "timestamp": "2026-02-17T04:59:33"
    },
    {
      "agent": "gemini",
      "task": "implement #1171",
      "success": false,
      "result": null,
      "raw_output": "",
      "errors": "Build OK but tests failed. Changes left in working tree.",
      "files_modified": [
        ".project-roadmap/issues-db/upstream/1128.json",
        ".project-roadmap/scripts/chain-context/_timeout_history.json",
        "mRemoteNG/Config/Connections/Multiuser/RemoteConnectionsSyncronizer.cs",
        "mRemoteNG/Config/Connections/Multiuser/SqlConnectionsUpdateChecker.cs",
        "mRemoteNG/UI/Forms/frmMain.cs",
        "mRemoteNG/UI/Menu/msMain/ViewMenu.cs",
        "mRemoteNG/UI/Tabs/DockPaneStripNG.cs",
        "mRemoteNG/UI/Window/ConnectionTreeWindow.cs",
        "mRemoteNG/UI/Window/ConnectionWindow.cs"
      ],
      "build_result": "OK",
      "test_result": "FAIL",
      "timed_out": false,
      "diff_summary": ".project-roadmap/issues-db/upstream/1128.json      | 15 ++++--\n .../scripts/chain-context/_timeout_history.json    | 23 ++++++--\n .../Multiuser/RemoteConnectionsSyncronizer.cs      |  2 +-\n .../Multiuser/SqlConnectionsUpdateChecker.cs       |  7 ++-\n mRemoteNG/UI/Forms/frmMain.cs                      | 19 +------\n mRemoteNG/UI/Menu/msMain/ViewMenu.cs               | 28 ++++++++++\n mRemoteNG/UI/Tabs/DockPaneStripNG.cs               | 11 ++++\n mRemoteNG/UI/Window/ConnectionTreeWindow.cs        | 61 +++++++++++++++++++++-\n mRemoteNG/UI/Window/ConnectionWindow.cs            |  4 --\n 9 files changed, 134 insertions(+), 36 deletions(-)",
      "timestamp": "2026-02-17T05:09:48",
      "diff_output": "diff --git a/.project-roadmap/issues-db/upstream/1128.json b/.project-roadmap/issues-db/upstream/1128.json\nindex 078a1e42d..5e0bf56ee 100644\n--- a/.project-roadmap/issues-db/upstream/1128.json\n+++ b/.project-roadmap/issues-db/upstream/1128.json\n@@ -10,17 +10,24 @@\n   \"created_at\": \"2018-10-10T05:53:18Z\",\n   \"github_updated_at\": \"2018-10-15T13:15:22Z\",\n   \"body_snippet\": \"We're using latest mRemoteNG stable 1.76.10 with and SQL database backend for sharing the connections.\\r\\nIn the database are about ~40 connections, mainly RDP.\\r\\n\\r\\nTwo users are using mRemoteNG, connected to the same sql db.\\r\\nAs soon as the 1st user opens a connection in mRemoteNG, the connection tree of the 2nd user flickers starts to flicker and a hourglass cursor appears.\\r\\n\\r\\nSometimes the problem is gone after a few seconds, sometimes we have to kill the process.\\r\\nThe problem is reproducable.\\r\\n...\",\n-  \"our_status\": \"new\",\n-  \"priority\": null,\n+  \"our_status\": \"triaged\",\n+  \"priority\": \"P2-bug\",\n   \"target_release\": null,\n   \"our_branch\": null,\n   \"our_pr\": null,\n-  \"iterations\": [],\n+  \"iterations\": [\n+    {\n+      \"seq\": 1,\n+      \"date\": \"2026-02-17\",\n+      \"type\": \"triaged\",\n+      \"description\": \"The SQL connection updater replaces the entire connection tree model whenever any user updates the database, causing flickering and UI freezing (hourglass). This is due to a naive implementation of the multi-user sync feature which triggers a full reload instead of a delta update.\"\n+    }\n+  ],\n   \"comments\": [],\n   \"comments_cursor\": \"2018-10-15T13:15:22Z\",\n   \"unread_comments\": 0,\n   \"needs_action\": false,\n   \"waiting_for_us\": false,\n   \"last_synced\": \"2026-02-15T09:52:50Z\",\n-  \"notes\": \"\"\n+  \"notes\": \"AI triage (gemini): The SQL connection updater replaces the entire connection tree model whenever any user updates the database, causing flickering and UI freezing (hourglass). This is due to a naive implementation of the multi-user sync feature which triggers a full reload instead of a delta update.\\nApproach: Modify SqlConnectionsUpdateChecker to detect specific changes or implement a diff-based update mechanism to avoid full tree reloads. Optimize the update frequency or move the heavy lifting off the UI thread completely, ensuring the UI is only updated when necessary and without blocking.\"\n }\ndiff --git a/.project-roadmap/scripts/chain-context/_timeout_history.json b/.project-roadmap/scripts/chain-context/_timeout_history.json\nindex 9b864d3f2..56aa30960 100644\n--- a/.project-roadmap/scripts/chain-context/_timeout_history.json\n+++ b/.project-roadmap/scripts/chain-context/_timeout_history.json\n@@ -20,7 +20,11 @@\n         187.8,\n         308.0,\n         203.1,\n-        144.0\n+        144.0,\n+        251.1,\n+        248.2,\n+        206.4,\n+        207.1\n       ],\n       \"triage\": [\n         24.5,\n@@ -32,7 +36,8 @@\n         78.1,\n         50.0,\n         20.1,\n-        27.8\n+        27.8,\n+        24.0\n       ]\n     },\n     \"gemini\": {\n@@ -48,7 +53,10 @@\n         491.9,\n         442.0,\n         481.7,\n-        397.5\n+        397.5,\n+        153.5,\n+        332.7,\n+        591.5\n       ],\n       \"triage\": [\n         74.7,\n@@ -71,12 +79,17 @@\n         73.3,\n         98.5,\n         86.4,\n-        112.9\n+        112.9,\n+        62.3,\n+        120.2,\n+        78.6,\n+        100.1\n       ]\n     }\n   },\n   \"escalations\": {\n     \"triage_1083\": 1.5,\n-    \"triage_1086\": 1.5\n+    \"triage_1086\": 1.5,\n+    \"triage_1157\": 1.5\n   }\n }\ndiff --git a/mRemoteNG/Config/Connections/Multiuser/RemoteConnectionsSyncronizer.cs b/mRemoteNG/Config/Connections/Multiuser/RemoteConnectionsSyncronizer.cs\nindex fb58ea02d..ab4a7e117 100644\n--- a/mRemoteNG/Config/Connections/Multiuser/RemoteConnectionsSyncronizer.cs\n+++ b/mRemoteNG/Config/Connections/Multiuser/RemoteConnectionsSyncronizer.cs\n@@ -21,7 +21,7 @@ namespace mRemoteNG.Config.Connections.Multiuser\n         public RemoteConnectionsSyncronizer(IConnectionsUpdateChecker updateChecker)\n         {\n             _updateChecker = updateChecker;\n-            _updateTimer = new System.Timers.Timer(3000);\n+            _updateTimer = new System.Timers.Timer(5000);\n             SetEventListeners();\n         }\n \ndiff --git a/mRemoteNG/Config/Connections/Multiuser/SqlConnectionsUpdateChecker.cs b/mRemoteNG/Config/Connections/Multiuser/SqlConnectionsUpdateChecker.cs\nindex 14dc1110c..f556135db 100644\n--- a/mRemoteNG/Config/Connections/Multiuser/SqlConnectionsUpdateChecker.cs\n+++ b/mRemoteNG/Config/Connections/Multiuser/SqlConnectionsUpdateChecker.cs\n@@ -64,8 +64,11 @@ namespace mRemoteNG.Config.Connections.Multiuser\n \n         private bool CheckIfIAmTheLastOneUpdated(DateTime lastUpdateInDb)\n         {\n-            DateTime lastSqlUpdateWithoutMilliseconds = new(LastUpdateTime.Ticks - (LastUpdateTime.Ticks % TimeSpan.TicksPerSecond), LastUpdateTime.Kind);\n-            return lastUpdateInDb == lastSqlUpdateWithoutMilliseconds;\n+            // We allow a small tolerance because the DB timestamp (generated by client before save)\n+            // and LastUpdateTime (generated by client after save) might differ slightly,\n+            // and SQL Server datetime precision (3.33ms) might cause rounding.\n+            TimeSpan diff = LastUpdateTime - lastUpdateInDb;\n+            return diff.TotalSeconds >= -1.0 && diff.TotalSeconds < 2.0;\n         }\n \n         private DateTime GetLastUpdateTimeFromDbResponse()\ndiff --git a/mRemoteNG/UI/Forms/frmMain.cs b/mRemoteNG/UI/Forms/frmMain.cs\nindex 70eea463c..edee83746 100644\n--- a/mRemoteNG/UI/Forms/frmMain.cs\n+++ b/mRemoteNG/UI/Forms/frmMain.cs\n@@ -1093,24 +1093,7 @@ namespace mRemoteNG.UI.Forms\n             }\n \n             // TODO: See if we can get this to work with DPS\n-#if false\n-            foreach (var dockContent in pnlDock.Documents)\n-\t\t\t{\n-\t\t\t\tvar document = (DockContent)dockContent;\n-\t\t\t\tif (document is ConnectionWindow)\n-\t\t\t\t{\n-\t\t\t\t\tvar connectionWindow = (ConnectionWindow)document;\n-\t\t\t\t\tif (Settings.Default.AlwaysShowConnectionTabs == false)\n-\t\t\t\t\t{\n-\t\t\t\t\t\tconnectionWindow.TabController.HideTabsMode = TabControl.HideTabsModes.HidepnlDock.DockLeftPortion = Always;\n-\t\t\t\t\t}\n-\t\t\t\t\telse\n-\t\t\t\t\t{\n-\t\t\t\t\t\tconnectionWindow.TabController.HideTabsMode = TabControl.HideTabsModes.ShowAlways;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-#endif\n+\n \n             if (pnlDock.DocumentStyle == newDocumentStyle) return;\n             pnlDock.DocumentStyle = newDocumentStyle;\ndiff --git a/mRemoteNG/UI/Menu/msMain/ViewMenu.cs b/mRemoteNG/UI/Menu/msMain/ViewMenu.cs\nindex 9b40dd759..2eaea02fd 100644\n--- a/mRemoteNG/UI/Menu/msMain/ViewMenu.cs\n+++ b/mRemoteNG/UI/Menu/msMain/ViewMenu.cs\n@@ -23,6 +23,7 @@ namespace mRemoteNG.UI.Menu\n         private ToolStripSeparator _mMenViewSep2 = null!;\n         private ToolStripMenuItem _mMenViewFullscreen = null!;\n         public ToolStripMenuItem _mMenViewExtAppsToolbar = null!;\n+        public ToolStripMenuItem _mMenViewConnectionTabs = null!;\n         public ToolStripMenuItem _mMenViewQuickConnectToolbar = null!;\n         public ToolStripMenuItem _mMenViewMultiSshToolbar = null!;\n         private ToolStripMenuItem _mMenViewResetLayout = null!;\n@@ -60,6 +61,7 @@ namespace mRemoteNG.UI.Menu\n             _mMenViewQuickConnectToolbar = new ToolStripMenuItem();\n             _mMenReconnectAll = new ToolStripMenuItem();\n             _mMenViewExtAppsToolbar = new ToolStripMenuItem();\n+            _mMenViewConnectionTabs = new ToolStripMenuItem();\n             _mMenViewMultiSshToolbar = new ToolStripMenuItem();\n             _mMenViewFullscreen = new ToolStripMenuItem();\n \n@@ -73,6 +75,7 @@ namespace mRemoteNG.UI.Menu\n                 _mMenViewQuickConnectToolbar,\n                 _mMenViewExtAppsToolbar,\n                 _mMenViewMultiSshToolbar,\n+                _mMenViewConnectionTabs,\n                 _mMenViewSep1,\n                 _mMenReconnectAll,\n                 _mMenViewAddConnectionPanel,\n@@ -182,6 +185,13 @@ namespace mRemoteNG.UI.Menu\n             _mMenViewExtAppsToolbar.Text = Language.ExternalToolsToolbar;\n             _mMenViewExtAppsToolbar.Click += mMenViewExtAppsToolbar_Click;\n             // \n+            // mMenViewConnectionTabs\n+            // \n+            _mMenViewConnectionTabs.Name = \"mMenViewConnectionTabs\";\n+            _mMenViewConnectionTabs.Size = new System.Drawing.Size(228, 22);\n+            _mMenViewConnectionTabs.Text = Language.AlwaysShowConnectionTabs;\n+            _mMenViewConnectionTabs.Click += mMenViewConnectionTabs_Click;\n+            // \n             // mMenViewMultiSSHToolbar\n             // \n             _mMenViewMultiSshToolbar.Name = \"mMenViewMultiSSHToolbar\";\n@@ -213,6 +223,7 @@ namespace mRemoteNG.UI.Menu\n             _mMenViewLockToolbars.Text = Language.LockToolbars;\n             _mMenViewQuickConnectToolbar.Text = Language.QuickConnectToolbar;\n             _mMenViewExtAppsToolbar.Text = Language.ExternalToolsToolbar;\n+            _mMenViewConnectionTabs.Text = Language.AlwaysShowConnectionTabs;\n             _mMenViewMultiSshToolbar.Text = Language.MultiSshToolbar;\n             _mMenViewFullscreen.Text = Language.Fullscreen;\n         }\n@@ -226,6 +237,7 @@ namespace mRemoteNG.UI.Menu\n \n             if (TsExternalTools is not null)\n                 _mMenViewExtAppsToolbar.Checked = TsExternalTools.Visible;\n+            _mMenViewConnectionTabs.Checked = mRemoteNG.Properties.OptionsTabsPanelsPage.Default.AlwaysShowConnectionTabs;\n             if (TsQuickConnect is not null)\n                 _mMenViewQuickConnectToolbar.Checked = TsQuickConnect.Visible;\n             if (TsMultiSsh is not null)\n@@ -351,6 +363,22 @@ namespace mRemoteNG.UI.Menu\n             }\n         }\n \n+        private void mMenViewConnectionTabs_Click(object sender, EventArgs e)\n+        {\n+            mRemoteNG.Properties.OptionsTabsPanelsPage.Default.AlwaysShowConnectionTabs = !mRemoteNG.Properties.OptionsTabsPanelsPage.Default.AlwaysShowConnectionTabs;\n+            _mMenViewConnectionTabs.Checked = mRemoteNG.Properties.OptionsTabsPanelsPage.Default.AlwaysShowConnectionTabs;\n+            \n+            if (MainForm?.pnlDock != null)\n+            {\n+                MainForm.pnlDock.Refresh();\n+                foreach (var pane in MainForm.pnlDock.Panes)\n+                {\n+                   if (pane is Control control) control.PerformLayout();\n+                   pane.Refresh();\n+                }\n+            }\n+        }\n+\n         private void mMenViewQuickConnectToolbar_Click(object sender, EventArgs e)\n         {\n             if (_mMenViewQuickConnectToolbar.Checked)\ndiff --git a/mRemoteNG/UI/Tabs/DockPaneStripNG.cs b/mRemoteNG/UI/Tabs/DockPaneStripNG.cs\nindex 9b5c91215..12a1892d2 100644\n--- a/mRemoteNG/UI/Tabs/DockPaneStripNG.cs\n+++ b/mRemoteNG/UI/Tabs/DockPaneStripNG.cs\n@@ -393,6 +393,17 @@ namespace mRemoteNG.UI.Tabs\n \n         private int MeasureHeight_Document()\n         {\n+            if (mRemoteNG.Properties.OptionsTabsPanelsPage.Default.AlwaysShowConnectionTabs == false)\n+            {\n+                foreach (Tab tab in Tabs)\n+                {\n+                    if (tab.Content is ConnectionTab)\n+                    {\n+                        return 0;\n+                    }\n+                }\n+            }\n+\n             int height =\n                 Math.Max(\n                          TextFont.Height + DocumentTabGapTop +\ndiff --git a/mRemoteNG/UI/Window/ConnectionTreeWindow.cs b/mRemoteNG/UI/Window/ConnectionTreeWindow.cs\nindex 5fd35be50..0573e504b 100644\n--- a/mRemoteNG/UI/Window/ConnectionTreeWindow.cs\n+++ b/mRemoteNG/UI/Window/ConnectionTreeWindow.cs\n@@ -191,8 +191,65 @@ namespace mRemoteNG.UI.Window\n                 return;\n             }\n \n-            ConnectionTree.ConnectionTreeModel = connectionsLoadedEventArgs.NewConnectionTreeModel;\n-            ConnectionTree.SelectedObject = connectionsLoadedEventArgs.NewConnectionTreeModel.RootNodes.FirstOrDefault();\n+            ConnectionTree.BeginUpdate();\n+            Cursor.Current = Cursors.Default;\n+\n+            HashSet<string> expandedNodeIds = new();\n+            string? selectedNodeId = null;\n+\n+            try\n+            {\n+                // Capture state\n+                if (ConnectionTree.ExpandedObjects != null)\n+                {\n+                    foreach (object? obj in ConnectionTree.ExpandedObjects)\n+                    {\n+                        if (obj is ConnectionInfo info)\n+                            expandedNodeIds.Add(info.ConstantID);\n+                    }\n+                }\n+\n+                if (ConnectionTree.SelectedObject is ConnectionInfo selectedInfo)\n+                {\n+                    selectedNodeId = selectedInfo.ConstantID;\n+                }\n+\n+                ConnectionTree.ConnectionTreeModel = connectionsLoadedEventArgs.NewConnectionTreeModel;\n+\n+                // Restore state\n+                var nodeLookup = new Dictionary<string, ConnectionInfo>();\n+                foreach (var node in connectionsLoadedEventArgs.NewConnectionTreeModel.GetRecursiveChildList())\n+                {\n+                    nodeLookup[node.ConstantID] = node;\n+                }\n+\n+                foreach (string id in expandedNodeIds)\n+                {\n+                    if (nodeLookup.TryGetValue(id, out ConnectionInfo? node))\n+                    {\n+                        ConnectionTree.Expand(node);\n+                    }\n+                }\n+\n+                if (selectedNodeId != null && nodeLookup.TryGetValue(selectedNodeId, out ConnectionInfo? newSelectedNode))\n+                {\n+                    ConnectionTree.SelectedObject = newSelectedNode;\n+                    ConnectionTree.EnsureModelVisible(newSelectedNode);\n+                }\n+                else\n+                {\n+                    ConnectionTree.SelectedObject = connectionsLoadedEventArgs.NewConnectionTreeModel.RootNodes.FirstOrDefault();\n+                }\n+            }\n+            catch (Exception ex)\n+            {\n+                Runtime.MessageCollector.AddExceptionStackTrace(\"Error restoring connection tree state\", ex);\n+                ConnectionTree.SelectedObject = connectionsLoadedEventArgs.NewConnectionTreeModel.RootNodes.FirstOrDefault();\n+            }\n+            finally\n+            {\n+                ConnectionTree.EndUpdate();\n+            }\n         }\n \n         #endregion\ndiff --git a/mRemoteNG/UI/Window/ConnectionWindow.cs b/mRemoteNG/UI/Window/ConnectionWindow.cs\nindex f1a03e90b..4a4cef1d6 100644\n--- a/mRemoteNG/UI/Window/ConnectionWindow.cs\n+++ b/mRemoteNG/UI/Window/ConnectionWindow.cs\n@@ -573,10 +573,6 @@ namespace mRemoteNG.UI.Window\n                 conTab.TrackConnection(connectionInfo);\n                 conTab.HideClosedState();\n \n-                //if (Settings.Default.AlwaysShowConnectionTabs == false)\n-                // TODO: See if we can make this work with DPS...\n-                //TabController.HideTabsMode = TabControl.HideTabsModes.HideAlways;\n-\n                 // Ensure the ConnectionWindow is visible before adding the tab\n                 // This prevents visibility issues when the window was created but not yet shown\n                 // Check DockState instead of Visible to properly detect if window is shown in DockPanel",
      "test_output": "=== mRemoteNG Test Runner ===\nCPU: 48 logical processors\nTimeout: 15000ms per test\nMode: Full parallel (5 processes)\n\nCleaning stale processes...\nERROR: Test DLL not found at D:\\github\\mRemoteNG\\mRemoteNGTests\\bin\\x64\\Release\\mRemoteNGTests.dll\n\n"
    },
    {
      "agent": "claude",
      "task": "implement #1171",
      "success": false,
      "result": null,
      "raw_output": "",
      "errors": "Build OK but tests failed. Changes left in working tree.",
      "files_modified": [
        ".project-roadmap/issues-db/upstream/1128.json",
        ".project-roadmap/scripts/chain-context/_timeout_history.json",
        "build_test.ps1",
        "mRemoteNG/Config/Connections/Multiuser/RemoteConnectionsSyncronizer.cs",
        "mRemoteNG/Config/Connections/Multiuser/SqlConnectionsUpdateChecker.cs",
        "mRemoteNG/UI/Forms/frmMain.cs",
        "mRemoteNG/UI/Menu/msMain/ViewMenu.cs",
        "mRemoteNG/UI/Tabs/DockPaneStripNG.cs",
        "mRemoteNG/UI/Window/ConnectionTreeWindow.cs",
        "mRemoteNG/UI/Window/ConnectionWindow.cs"
      ],
      "build_result": "OK",
      "test_result": "FAIL",
      "timed_out": false,
      "diff_summary": ".project-roadmap/issues-db/upstream/1128.json      | 15 ++++--\n .../scripts/chain-context/_timeout_history.json    | 24 +++++++--\n build_test.ps1                                     |  2 +-\n .../Multiuser/RemoteConnectionsSyncronizer.cs      |  2 +-\n .../Multiuser/SqlConnectionsUpdateChecker.cs       |  7 ++-\n mRemoteNG/UI/Forms/frmMain.cs                      | 19 +------\n mRemoteNG/UI/Menu/msMain/ViewMenu.cs               | 28 ++++++++++\n mRemoteNG/UI/Tabs/DockPaneStripNG.cs               | 11 ++++\n mRemoteNG/UI/Window/ConnectionTreeWindow.cs        | 61 +++++++++++++++++++++-\n mRemoteNG/UI/Window/ConnectionWindow.cs            |  4 --\n 10 files changed, 136 insertions(+), 37 deletions(-)",
      "timestamp": "2026-02-17T05:14:13",
      "diff_output": "diff --git a/.project-roadmap/issues-db/upstream/1128.json b/.project-roadmap/issues-db/upstream/1128.json\nindex 078a1e42d..5e0bf56ee 100644\n--- a/.project-roadmap/issues-db/upstream/1128.json\n+++ b/.project-roadmap/issues-db/upstream/1128.json\n@@ -10,17 +10,24 @@\n   \"created_at\": \"2018-10-10T05:53:18Z\",\n   \"github_updated_at\": \"2018-10-15T13:15:22Z\",\n   \"body_snippet\": \"We're using latest mRemoteNG stable 1.76.10 with and SQL database backend for sharing the connections.\\r\\nIn the database are about ~40 connections, mainly RDP.\\r\\n\\r\\nTwo users are using mRemoteNG, connected to the same sql db.\\r\\nAs soon as the 1st user opens a connection in mRemoteNG, the connection tree of the 2nd user flickers starts to flicker and a hourglass cursor appears.\\r\\n\\r\\nSometimes the problem is gone after a few seconds, sometimes we have to kill the process.\\r\\nThe problem is reproducable.\\r\\n...\",\n-  \"our_status\": \"new\",\n-  \"priority\": null,\n+  \"our_status\": \"triaged\",\n+  \"priority\": \"P2-bug\",\n   \"target_release\": null,\n   \"our_branch\": null,\n   \"our_pr\": null,\n-  \"iterations\": [],\n+  \"iterations\": [\n+    {\n+      \"seq\": 1,\n+      \"date\": \"2026-02-17\",\n+      \"type\": \"triaged\",\n+      \"description\": \"The SQL connection updater replaces the entire connection tree model whenever any user updates the database, causing flickering and UI freezing (hourglass). This is due to a naive implementation of the multi-user sync feature which triggers a full reload instead of a delta update.\"\n+    }\n+  ],\n   \"comments\": [],\n   \"comments_cursor\": \"2018-10-15T13:15:22Z\",\n   \"unread_comments\": 0,\n   \"needs_action\": false,\n   \"waiting_for_us\": false,\n   \"last_synced\": \"2026-02-15T09:52:50Z\",\n-  \"notes\": \"\"\n+  \"notes\": \"AI triage (gemini): The SQL connection updater replaces the entire connection tree model whenever any user updates the database, causing flickering and UI freezing (hourglass). This is due to a naive implementation of the multi-user sync feature which triggers a full reload instead of a delta update.\\nApproach: Modify SqlConnectionsUpdateChecker to detect specific changes or implement a diff-based update mechanism to avoid full tree reloads. Optimize the update frequency or move the heavy lifting off the UI thread completely, ensuring the UI is only updated when necessary and without blocking.\"\n }\ndiff --git a/.project-roadmap/scripts/chain-context/_timeout_history.json b/.project-roadmap/scripts/chain-context/_timeout_history.json\nindex 9b864d3f2..6e3a0d43c 100644\n--- a/.project-roadmap/scripts/chain-context/_timeout_history.json\n+++ b/.project-roadmap/scripts/chain-context/_timeout_history.json\n@@ -20,7 +20,12 @@\n         187.8,\n         308.0,\n         203.1,\n-        144.0\n+        144.0,\n+        251.1,\n+        248.2,\n+        206.4,\n+        207.1,\n+        243.5\n       ],\n       \"triage\": [\n         24.5,\n@@ -32,7 +37,8 @@\n         78.1,\n         50.0,\n         20.1,\n-        27.8\n+        27.8,\n+        24.0\n       ]\n     },\n     \"gemini\": {\n@@ -48,7 +54,10 @@\n         491.9,\n         442.0,\n         481.7,\n-        397.5\n+        397.5,\n+        153.5,\n+        332.7,\n+        591.5\n       ],\n       \"triage\": [\n         74.7,\n@@ -71,12 +80,17 @@\n         73.3,\n         98.5,\n         86.4,\n-        112.9\n+        112.9,\n+        62.3,\n+        120.2,\n+        78.6,\n+        100.1\n       ]\n     }\n   },\n   \"escalations\": {\n     \"triage_1083\": 1.5,\n-    \"triage_1086\": 1.5\n+    \"triage_1086\": 1.5,\n+    \"triage_1157\": 1.5\n   }\n }\ndiff --git a/build_test.ps1 b/build_test.ps1\nindex 55d3550ba..2081ae053 100644\n--- a/build_test.ps1\n+++ b/build_test.ps1\n@@ -29,4 +29,4 @@ if (-not $devShell) {\n Write-Host \"Using: $devShell\"\n & $devShell -Arch amd64\n \n-MSBuild.exe mRemoteNGTests\\mRemoteNGTests.csproj -restore -m \"-verbosity:normal\" \"-p:Configuration=Release\" \"-p:Platform=x64\" -t:Rebuild\n+MSBuild.exe mRemoteNGTests\\mRemoteNGTests.csproj -restore -m \"-verbosity:normal\" \"-p:Configuration=Debug\" \"-p:Platform=x64\" -t:Rebuild\ndiff --git a/mRemoteNG/Config/Connections/Multiuser/RemoteConnectionsSyncronizer.cs b/mRemoteNG/Config/Connections/Multiuser/RemoteConnectionsSyncronizer.cs\nindex fb58ea02d..ab4a7e117 100644\n--- a/mRemoteNG/Config/Connections/Multiuser/RemoteConnectionsSyncronizer.cs\n+++ b/mRemoteNG/Config/Connections/Multiuser/RemoteConnectionsSyncronizer.cs\n@@ -21,7 +21,7 @@ namespace mRemoteNG.Config.Connections.Multiuser\n         public RemoteConnectionsSyncronizer(IConnectionsUpdateChecker updateChecker)\n         {\n             _updateChecker = updateChecker;\n-            _updateTimer = new System.Timers.Timer(3000);\n+            _updateTimer = new System.Timers.Timer(5000);\n             SetEventListeners();\n         }\n \ndiff --git a/mRemoteNG/Config/Connections/Multiuser/SqlConnectionsUpdateChecker.cs b/mRemoteNG/Config/Connections/Multiuser/SqlConnectionsUpdateChecker.cs\nindex 14dc1110c..f556135db 100644\n--- a/mRemoteNG/Config/Connections/Multiuser/SqlConnectionsUpdateChecker.cs\n+++ b/mRemoteNG/Config/Connections/Multiuser/SqlConnectionsUpdateChecker.cs\n@@ -64,8 +64,11 @@ namespace mRemoteNG.Config.Connections.Multiuser\n \n         private bool CheckIfIAmTheLastOneUpdated(DateTime lastUpdateInDb)\n         {\n-            DateTime lastSqlUpdateWithoutMilliseconds = new(LastUpdateTime.Ticks - (LastUpdateTime.Ticks % TimeSpan.TicksPerSecond), LastUpdateTime.Kind);\n-            return lastUpdateInDb == lastSqlUpdateWithoutMilliseconds;\n+            // We allow a small tolerance because the DB timestamp (generated by client before save)\n+            // and LastUpdateTime (generated by client after save) might differ slightly,\n+            // and SQL Server datetime precision (3.33ms) might cause rounding.\n+            TimeSpan diff = LastUpdateTime - lastUpdateInDb;\n+            return diff.TotalSeconds >= -1.0 && diff.TotalSeconds < 2.0;\n         }\n \n         private DateTime GetLastUpdateTimeFromDbResponse()\ndiff --git a/mRemoteNG/UI/Forms/frmMain.cs b/mRemoteNG/UI/Forms/frmMain.cs\nindex 70eea463c..edee83746 100644\n--- a/mRemoteNG/UI/Forms/frmMain.cs\n+++ b/mRemoteNG/UI/Forms/frmMain.cs\n@@ -1093,24 +1093,7 @@ namespace mRemoteNG.UI.Forms\n             }\n \n             // TODO: See if we can get this to work with DPS\n-#if false\n-            foreach (var dockContent in pnlDock.Documents)\n-\t\t\t{\n-\t\t\t\tvar document = (DockContent)dockContent;\n-\t\t\t\tif (document is ConnectionWindow)\n-\t\t\t\t{\n-\t\t\t\t\tvar connectionWindow = (ConnectionWindow)document;\n-\t\t\t\t\tif (Settings.Default.AlwaysShowConnectionTabs == false)\n-\t\t\t\t\t{\n-\t\t\t\t\t\tconnectionWindow.TabController.HideTabsMode = TabControl.HideTabsModes.HidepnlDock.DockLeftPortion = Always;\n-\t\t\t\t\t}\n-\t\t\t\t\telse\n-\t\t\t\t\t{\n-\t\t\t\t\t\tconnectionWindow.TabController.HideTabsMode = TabControl.HideTabsModes.ShowAlways;\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\t\t\t}\n-#endif\n+\n \n             if (pnlDock.DocumentStyle == newDocumentStyle) return;\n             pnlDock.DocumentStyle = newDocumentStyle;\ndiff --git a/mRemoteNG/UI/Menu/msMain/ViewMenu.cs b/mRemoteNG/UI/Menu/msMain/ViewMenu.cs\nindex 9b40dd759..2eaea02fd 100644\n--- a/mRemoteNG/UI/Menu/msMain/ViewMenu.cs\n+++ b/mRemoteNG/UI/Menu/msMain/ViewMenu.cs\n@@ -23,6 +23,7 @@ namespace mRemoteNG.UI.Menu\n         private ToolStripSeparator _mMenViewSep2 = null!;\n         private ToolStripMenuItem _mMenViewFullscreen = null!;\n         public ToolStripMenuItem _mMenViewExtAppsToolbar = null!;\n+        public ToolStripMenuItem _mMenViewConnectionTabs = null!;\n         public ToolStripMenuItem _mMenViewQuickConnectToolbar = null!;\n         public ToolStripMenuItem _mMenViewMultiSshToolbar = null!;\n         private ToolStripMenuItem _mMenViewResetLayout = null!;\n@@ -60,6 +61,7 @@ namespace mRemoteNG.UI.Menu\n             _mMenViewQuickConnectToolbar = new ToolStripMenuItem();\n             _mMenReconnectAll = new ToolStripMenuItem();\n             _mMenViewExtAppsToolbar = new ToolStripMenuItem();\n+            _mMenViewConnectionTabs = new ToolStripMenuItem();\n             _mMenViewMultiSshToolbar = new ToolStripMenuItem();\n             _mMenViewFullscreen = new ToolStripMenuItem();\n \n@@ -73,6 +75,7 @@ namespace mRemoteNG.UI.Menu\n                 _mMenViewQuickConnectToolbar,\n                 _mMenViewExtAppsToolbar,\n                 _mMenViewMultiSshToolbar,\n+                _mMenViewConnectionTabs,\n                 _mMenViewSep1,\n                 _mMenReconnectAll,\n                 _mMenViewAddConnectionPanel,\n@@ -182,6 +185,13 @@ namespace mRemoteNG.UI.Menu\n             _mMenViewExtAppsToolbar.Text = Language.ExternalToolsToolbar;\n             _mMenViewExtAppsToolbar.Click += mMenViewExtAppsToolbar_Click;\n             // \n+            // mMenViewConnectionTabs\n+            // \n+            _mMenViewConnectionTabs.Name = \"mMenViewConnectionTabs\";\n+            _mMenViewConnectionTabs.Size = new System.Drawing.Size(228, 22);\n+            _mMenViewConnectionTabs.Text = Language.AlwaysShowConnectionTabs;\n+            _mMenViewConnectionTabs.Click += mMenViewConnectionTabs_Click;\n+            // \n             // mMenViewMultiSSHToolbar\n             // \n             _mMenViewMultiSshToolbar.Name = \"mMenViewMultiSSHToolbar\";\n@@ -213,6 +223,7 @@ namespace mRemoteNG.UI.Menu\n             _mMenViewLockToolbars.Text = Language.LockToolbars;\n             _mMenViewQuickConnectToolbar.Text = Language.QuickConnectToolbar;\n             _mMenViewExtAppsToolbar.Text = Language.ExternalToolsToolbar;\n+            _mMenViewConnectionTabs.Text = Language.AlwaysShowConnectionTabs;\n             _mMenViewMultiSshToolbar.Text = Language.MultiSshToolbar;\n             _mMenViewFullscreen.Text = Language.Fullscreen;\n         }\n@@ -226,6 +237,7 @@ namespace mRemoteNG.UI.Menu\n \n             if (TsExternalTools is not null)\n                 _mMenViewExtAppsToolbar.Checked = TsExternalTools.Visible;\n+            _mMenViewConnectionTabs.Checked = mRemoteNG.Properties.OptionsTabsPanelsPage.Default.AlwaysShowConnectionTabs;\n             if (TsQuickConnect is not null)\n                 _mMenViewQuickConnectToolbar.Checked = TsQuickConnect.Visible;\n             if (TsMultiSsh is not null)\n@@ -351,6 +363,22 @@ namespace mRemoteNG.UI.Menu\n             }\n         }\n \n+        private void mMenViewConnectionTabs_Click(object sender, EventArgs e)\n+        {\n+            mRemoteNG.Properties.OptionsTabsPanelsPage.Default.AlwaysShowConnectionTabs = !mRemoteNG.Properties.OptionsTabsPanelsPage.Default.AlwaysShowConnectionTabs;\n+            _mMenViewConnectionTabs.Checked = mRemoteNG.Properties.OptionsTabsPanelsPage.Default.AlwaysShowConnectionTabs;\n+            \n+            if (MainForm?.pnlDock != null)\n+            {\n+                MainForm.pnlDock.Refresh();\n+                foreach (var pane in MainForm.pnlDock.Panes)\n+                {\n+                   if (pane is Control control) control.PerformLayout();\n+                   pane.Refresh();\n+                }\n+            }\n+        }\n+\n         private void mMenViewQuickConnectToolbar_Click(object sender, EventArgs e)\n         {\n             if (_mMenViewQuickConnectToolbar.Checked)\ndiff --git a/mRemoteNG/UI/Tabs/DockPaneStripNG.cs b/mRemoteNG/UI/Tabs/DockPaneStripNG.cs\nindex 9b5c91215..12a1892d2 100644\n--- a/mRemoteNG/UI/Tabs/DockPaneStripNG.cs\n+++ b/mRemoteNG/UI/Tabs/DockPaneStripNG.cs\n@@ -393,6 +393,17 @@ namespace mRemoteNG.UI.Tabs\n \n         private int MeasureHeight_Document()\n         {\n+            if (mRemoteNG.Properties.OptionsTabsPanelsPage.Default.AlwaysShowConnectionTabs == false)\n+            {\n+                foreach (Tab tab in Tabs)\n+                {\n+                    if (tab.Content is ConnectionTab)\n+                    {\n+                        return 0;\n+                    }\n+                }\n+            }\n+\n             int height =\n                 Math.Max(\n                          TextFont.Height + DocumentTabGapTop +\ndiff --git a/mRemoteNG/UI/Window/ConnectionTreeWindow.cs b/mRemoteNG/UI/Window/ConnectionTreeWindow.cs\nindex 5fd35be50..0573e504b 100644\n--- a/mRemoteNG/UI/Window/ConnectionTreeWindow.cs\n+++ b/mRemoteNG/UI/Window/ConnectionTreeWindow.cs\n@@ -191,8 +191,65 @@ namespace mRemoteNG.UI.Window\n                 return;\n             }\n \n-            ConnectionTree.ConnectionTreeModel = connectionsLoadedEventArgs.NewConnectionTreeModel;\n-            ConnectionTree.SelectedObject = connectionsLoadedEventArgs.NewConnectionTreeModel.RootNodes.FirstOrDefault();\n+            ConnectionTree.BeginUpdate();\n+            Cursor.Current = Cursors.Default;\n+\n+            HashSet<string> expandedNodeIds = new();\n+            string? selectedNodeId = null;\n+\n+            try\n+            {\n+                // Capture state\n+                if (ConnectionTree.ExpandedObjects != null)\n+                {\n+                    foreach (object? obj in ConnectionTree.ExpandedObjects)\n+                    {\n+                        if (obj is ConnectionInfo info)\n+                            expandedNodeIds.Add(info.ConstantID);\n+                    }\n+                }\n+\n+                if (ConnectionTree.SelectedObject is ConnectionInfo selectedInfo)\n+                {\n+                    selectedNodeId = selectedInfo.ConstantID;\n+                }\n+\n+                ConnectionTree.ConnectionTreeModel = connectionsLoadedEventArgs.NewConnectionTreeModel;\n+\n+                // Restore state\n+                var nodeLookup = new Dictionary<string, ConnectionInfo>();\n+                foreach (var node in connectionsLoadedEventArgs.NewConnectionTreeModel.GetRecursiveChildList())\n+                {\n+                    nodeLookup[node.ConstantID] = node;\n+                }\n+\n+                foreach (string id in expandedNodeIds)\n+                {\n+                    if (nodeLookup.TryGetValue(id, out ConnectionInfo? node))\n+                    {\n+                        ConnectionTree.Expand(node);\n+                    }\n+                }\n+\n+                if (selectedNodeId != null && nodeLookup.TryGetValue(selectedNodeId, out ConnectionInfo? newSelectedNode))\n+                {\n+                    ConnectionTree.SelectedObject = newSelectedNode;\n+                    ConnectionTree.EnsureModelVisible(newSelectedNode);\n+                }\n+                else\n+                {\n+                    ConnectionTree.SelectedObject = connectionsLoadedEventArgs.NewConnectionTreeModel.RootNodes.FirstOrDefault();\n+                }\n+            }\n+            catch (Exception ex)\n+            {\n+                Runtime.MessageCollector.AddExceptionStackTrace(\"Error restoring connection tree state\", ex);\n+                ConnectionTree.SelectedObject = connectionsLoadedEventArgs.NewConnectionTreeModel.RootNodes.FirstOrDefault();\n+            }\n+            finally\n+            {\n+                ConnectionTree.EndUpdate();\n+            }\n         }\n \n         #endregion\ndiff --git a/mRemoteNG/UI/Window/ConnectionWindow.cs b/mRemoteNG/UI/Window/ConnectionWindow.cs\nindex f1a03e90b..4a4cef1d6 100644\n--- a/mRemoteNG/UI/Window/ConnectionWindow.cs\n+++ b/mRemoteNG/UI/Window/ConnectionWindow.cs\n@@ -573,10 +573,6 @@ namespace mRemoteNG.UI.Window\n                 conTab.TrackConnection(connectionInfo);\n                 conTab.HideClosedState();\n \n-                //if (Settings.Default.AlwaysShowConnectionTabs == false)\n-                // TODO: See if we can make this work with DPS...\n-                //TabController.HideTabsMode = TabControl.HideTabsModes.HideAlways;\n-\n                 // Ensure the ConnectionWindow is visible before adding the tab\n                 // This prevents visibility issues when the window was created but not yet shown\n                 // Check DockState instead of Visible to properly detect if window is shown in DockPanel",
      "test_output": "=== mRemoteNG Test Runner ===\nCPU: 48 logical processors\nTimeout: 15000ms per test\nMode: Full parallel (5 processes)\n\nCleaning stale processes...\nERROR: Test DLL not found at D:\\github\\mRemoteNG\\mRemoteNGTests\\bin\\x64\\Release\\mRemoteNGTests.dll\n\n"
    }
  ],
  "timeout_count": 0,
  "all_timed_out": false,
  "final_success": false
}
